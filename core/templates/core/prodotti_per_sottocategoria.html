{% extends 'base.html' %}
{% load static %}
{% block title %}Prodotti - {{ sottocategoria.nome }}{% endblock %}

{% block content %}
<section class="py-5" style="background: linear-gradient(to right, #f5f0e1, #e4dcca); min-height: 100vh;">
  <div class="container">

    <!-- Pulsante indietro -->
    <div class="mb-4">
      <a href="{% url 'prodotti' %}" class="btn btn-outline-dark rounded-pill shadow-sm px-4">
        <i class="fas fa-arrow-left me-1"></i> Torna al Negozio
      </a>
    </div>

    <!-- Titolo sottocategoria -->
    <h2 class="fw-bold text-center text-uppercase display-4 text-dark mb-3 animate__animated animate__fadeInDown">
      {{ sottocategoria.nome }}
    </h2>

    <!-- Mostra SCONTO se presente nella sottocategoria -->
    {% if sottocategoria.is_sconto %}
    <p class="text-center text-success fw-bold fs-5 mb-4">
      ðŸ”¥ Sconto del {{ sottocategoria.percentuale_sconto }}% su tutti i prodotti della categoria "{{ sottocategoria.nome }}"!
    </p>
    {% endif %}

    <!-- Testo personalizzato dell'admin -->
    {% if sottocategoria.contenuto_html %}
    <div class="text-center mb-5">
      <div class="mx-auto"
           style="width: {{ sottocategoria.contenuto_larghezza }}px;
                  height: {{ sottocategoria.contenuto_altezza }}px;
                  overflow: auto;
                  background: white;
                  border-radius: 16px;
                  padding: 30px;
                  box-shadow: 0 10px 30px rgba(0,0,0,0.08);">
        {{ sottocategoria.contenuto_html|safe }}
      </div>
    </div>
    {% endif %}

    <!-- Elenco prodotti -->
    {% if prodotti %}
    <div class="row g-4">
      {% for prodotto in prodotti %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch">
        <div class="card border-0 shadow-lg h-100 rounded-4 animate__animated animate__fadeInUp">
          <img src="{{ prodotto.immagine.url }}"
               alt="{{prodotto.nome}}"
               class="card-img-top rounded-top"
               style="height:250px; object-fit:cover;">
          <div class="card-body d-flex flex-column text-center">
            <h5 class="card-title fw-bold text-dark">{{ prodotto.nome }}</h5>
            <p class="card-text text-muted small flex-grow-1">{{ prodotto.descrizione|truncatechars:70 }}</p>

            {% if prodotto.prezzo_scontato and prodotto.prezzo_scontato < prodotto.prezzo %}
              <p class="text-danger mb-1">
                <del>â‚¬ {{ prodotto.prezzo|floatformat:2 }}</del>
              </p>
              <p class="fw-bold text-success fs-5 mb-1">
                â‚¬ {{ prodotto.prezzo_scontato|floatformat:2 }}
              </p>
            {% else %}
              <p class="fw-bold text-success fs-5 mb-1">â‚¬ {{ prodotto.prezzo|floatformat:2 }}</p>
            {% endif %}

            <p class="text-muted mb-2">DisponibilitÃ : {{ prodotto.disponibilita }}</p>
            <a href="{% url 'dettaglio_prodotto' prodotto.id %}" class="btn btn-primary btn-sm rounded-pill mt-auto shadow-sm">
              <i class="fas fa-eye me-1"></i> Dettagli
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center shadow-sm mt-5">
      Nessun prodotto disponibile per questa sottocategoria.
    </div>
    {% endif %}
  </div>
</section>
{% endblock %}
