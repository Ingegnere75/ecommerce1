{% extends 'base.html' %}
{% load static %}

{% block title %}Negozio - Samadafilati{% endblock %}

{% block content %}

<style>
.btn-custom {
  background: linear-gradient(135deg, #d3d3d3, #a9a9a9);
  border: none;
  color: #333;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.4s ease;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.btn-custom:hover {
  background: linear-gradient(135deg, #a9a9a9, #d3d3d3);
  color: white;
  box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  transform: translateY(-2px);
}
</style>

<!-- Categorie Section Start -->
<section class="py-5">
  <div class="container">
    <h2 class="fw-bold text-center mb-5">Categorie</h2>
    <div class="row justify-content-center">
      {% for categoria in categorie %}
      <div class="col-md-4 col-lg-3 text-center mb-4 {% if forloop.counter0|divisibleby:2 %}animated-left{% else %}animated-right{% endif %}">
        <div onclick="caricaSottoCategorie({{ categoria.id }}, '{{ categoria.nome }}')" class="text-decoration-none d-block card-hover" style="cursor:pointer;">
          {% if categoria.immagine %}
            <img src="{{ categoria.immagine.url }}" alt="{{ categoria.nome }}"
              style="width:{{ categoria.larghezza|default:300 }}px; height:{{ categoria.altezza|default:200 }}px; object-fit:cover;"
              class="img-fluid mb-3 rounded shadow image-enhanced card-img-hover">
          {% else %}
            <img src="{% static 'img/default-placeholder.png' %}" alt="Nessuna immagine"
              style="width:300px; height:200px; object-fit:cover;" class="img-fluid mb-3 rounded shadow">
          {% endif %}
          <h5 class="fw-bold text-dark">{{ categoria.nome }}</h5>
          {% if categoria.descrizione %}
            <p class="text-muted small">{{ categoria.descrizione|truncatechars:500 }}</p>
          {% endif %}

          {% if categoria.is_sconto %}
            <p class="text-success fw-bold mt-2">Sconto del {{ categoria.percentuale_sconto }}% su questa categoria!</p>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
<!-- Categorie Section End -->



    <!-- Sottocategorie Section Start -->
<section class="py-5 bg-light" id="sottocategorie-section" style="display:none;">
  <div class="container">
    <h2 id="titolo-sottocategorie" class="fw-bold text-center mb-3"></h2>
    <h5 id="nome-sottocategoria" class="text-center text-muted mb-5"></h5>
    
    <div class="row justify-content-center" id="contenitore-sottocategorie">
      {% for sotto in sottocategorie %}
      <div class="col-md-4 col-lg-3 text-center mb-4 {% if forloop.counter0|divisibleby:2 %}animated-left{% else %}animated-right{% endif %}">
        <a href="{% url 'prodotti_sottocategoria' sotto.slug %}" class="text-decoration-none d-block card-hover" style="cursor:pointer;">
          
          {% if sotto.immagine %}
            <img src="{{ sotto.immagine.url }}" alt="{{ sotto.nome }}"
              style="width:{{ sotto.larghezza|default:300 }}px; height:{{ sotto.altezza|default:200 }}px; object-fit:cover;"
              class="img-fluid mb-3 rounded shadow image-enhanced card-img-hover">
          {% else %}
            <img src="{% static 'img/default-placeholder.png' %}" alt="Nessuna immagine"
              style="width:300px; height:200px; object-fit:cover;" class="img-fluid mb-3 rounded shadow">
          {% endif %}

          <h5 class="fw-bold text-dark">{{ sotto.nome }}</h5>

          {% if sotto.descrizione %}
            <p class="text-muted small">{{ sotto.descrizione|truncatechars:500 }}</p>
          {% endif %}

          {% if sotto.is_sconto %}
            <p class="text-success fw-bold mt-2">Sconto del {{ sotto.percentuale_sconto }}% su questa sottocategoria!</p>
          {% endif %}

        </a>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">Nessuna sottocategoria disponibile.</p>
      </div>
      {% endfor %}
    </div>

    <div class="text-center mt-4">
      <a href="{% url 'home' %}" class="btn btn-secondary">üè† Torna alla Home</a>
    </div>
  </div>
</section>
<!-- Sottocategorie Section End -->



    


{% if prodotti_consigliati %}
<section class="py-5 bg-light" id="consigliati-section">
  <div class="container">
    <h2 class="fw-bold text-center mb-5">Consigliati per te</h2>
    <div class="row justify-content-center gx-4 gy-4">
      {% for prodotto in prodotti_consigliati|slice:":6" %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 d-flex justify-content-center">
        <div class="card border-0 shadow-sm h-100 w-100" style="max-width: 220px;">
          {% if prodotto.immagine %}
            <img src="{{ prodotto.immagine.url }}" alt="{{ prodotto.nome }}"
              style="width:100%; height:150px; object-fit:cover;" class="img-fluid rounded-top image-enhanced card-img-hover">
          {% else %}
            <img src="{% static 'img/default-placeholder.png' %}" alt="Immagine non disponibile"
              style="width:100%; height:150px; object-fit:cover;" class="img-fluid rounded-top">
          {% endif %}
          <div class="card-body p-2 d-flex flex-column justify-content-between">
            <h6 class="fw-bold mb-1 text-beige text-center">{{ prodotto.nome|truncatechars:30 }}</h6>

            <!-- ‚úÖ Include del prezzo scontato e messaggio -->
            <div class="text-center mb-2">
              {% include 'includes/prezzo_scontato.html' with prodotto=prodotto %}
            </div>

            <p class="text-muted small" style="height:50px; overflow:hidden;">
              {{ prodotto.descrizione|truncatechars:500 }}
            </p>

            <form method="post" action="{% url 'dettaglio_prodotto' prodotto.id %}">
              {% csrf_token %}
              <button type="submit" class="btn-custom w-100 mt-2">Scopri di pi√π</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="text-center mt-4">
    <a href="{% url 'home' %}" class="btn btn-secondary">üè† Torna alla Home</a>
  </div>
</section>
{% endif %}

<!-- JS per caricamento sottocategorie -->
<script>
function caricaSottoCategorie(categoriaId, categoriaNome) {
  fetch(`/ajax/sottocategorie/${categoriaId}/`)
    .then(response => response.text())
    .then(html => {
      document.getElementById('contenitore-sottocategorie').innerHTML = html;
      document.getElementById('titolo-sottocategorie').innerText = `Scopri ${categoriaNome}`;
      document.getElementById('nome-sottocategoria').innerText = `Sottocategorie di ${categoriaNome}`;
      document.getElementById('sottocategorie-section').style.display = 'block';
      document.getElementById('consigliati-section').style.display = 'none';
      setTimeout(() => {
        const sezione = document.getElementById('sottocategorie-section');
        if (sezione) {
          sezione.scrollIntoView({ behavior: 'smooth' });
        }
      }, 100);
    })
    .catch(error => {
      console.error('Errore nel caricamento delle sottocategorie:', error);
    });
}
</script>

<style>
.animated-card, .animated-right, .animated-left {
  opacity: 0;
  animation-fill-mode: forwards;
  animation-duration: 1.5s;
  animation-timing-function: ease;
}
.animated-right {
  animation-name: slide-from-right;
}
.animated-left {
  animation-name: slide-from-left;
}
.animated-card {
  animation-name: slide-up-soft;
}
@keyframes slide-from-right {
  0% { transform: translateX(100px); opacity: 0; }
  100% { transform: translateX(0); opacity: 1; }
}
@keyframes slide-from-left {
  0% { transform: translateX(-100px); opacity: 0; }
  100% { transform: translateX(0); opacity: 1; }
}
@keyframes slide-up-soft {
  0% { transform: translateY(60px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}
.image-enhanced {
  filter: brightness(1.05) contrast(1.1) saturate(1.2);
}
.card-img-hover {
  transition: transform 0.5s ease;
}
.card-img-hover:hover {
  transform: scale(1.12) rotate(1.5deg);
}
.text-beige {
  color: #8B7D6B;
}
@media (max-width: 768px) {
  .card-body p {
    font-size: 0.85rem;
  }
}
</style>

{% endblock %}
