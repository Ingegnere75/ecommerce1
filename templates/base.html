  {% load static %}
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Samadafilati{% endblock %}</title>

  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;700&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'samadafilati/css/vendor.css' %}">
  <link rel="stylesheet" href="{% static 'samadafilati/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'bootstrap5/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'bootstrap5/css/style.css' %}">

  <style>
    html, body {
      height: 100%;
      font-family: 'Jost', sans-serif;
      background-color: #f6f4f2;
      color: #1a1a1a;
      scroll-behavior: smooth;
    }

    h1, h2, h3, h4, h5 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    main {
      flex: 1;
      padding-top: 1rem;
      padding-bottom: 2rem;
    }

    .navbar-brand {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.7rem;
    }

    .thank-you-banner {
      background-color: #eef7fc;
      padding: 30px;
      border-radius: 10px;
    }

    .thank-you-image img {
      max-width: 100%;
      transition: transform 0.3s ease-in-out;
    }

    .thank-you-image img:hover {
      transform: scale(1.05);
    }

    .order-details {
      background-color: #fafafa;
      padding: 20px;
      border-radius: 8px;
    }

    .cta-buttons a {
      transition: background-color 0.3s ease-in-out;
    }

    .cta-buttons a:hover {
      background-color: #ff5722;
      color: white;
    }

    .cookie-banner {
      font-size: 0.9rem;
    }

    .swal2-popup {
      font-family: 'Jost', sans-serif;
    }

    .alert {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

  {% include 'includes/navbar.html' %}

  <!-- Blocchi messaggi visibili solo se impostati -->
  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Chiudi"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <main class="container-fluid px-3 px-md-4">{% block content %}{% endblock %}</main>

  {% include 'includes/footer.html' %}

  <!-- Cookie Banner -->
  <div id="cookieBanner" class="cookie-banner bg-light text-dark p-3 shadow position-fixed bottom-0 w-100 d-none" style="z-index: 9999;">
    <div class="container d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <strong><i class="fas fa-cookie-bite me-1 text-warning"></i>Questo sito utilizza i cookie</strong><br>
        Utilizziamo i cookie per migliorare l’esperienza utente. Puoi accettare, rifiutare o gestire le preferenze.
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm" onclick="acceptCookies()">Accetta</button>
        <button class="btn btn-danger btn-sm" onclick="rejectCookies()">Rifiuta</button>
        <button class="btn btn-secondary btn-sm" onclick="manageCookies()">Gestisci</button>
      </div>
    </div>
  </div>

  <!-- JS & Bootstrap -->
  <script src="{% static 'kaira/js/vendor.js' %}"></script>
  <script src="{% static 'bootstrap5/js/bootstrap.bundle.min.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Cookie logic -->
  <script>
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function checkCookieConsent() {
      const consent = getCookie("cookie_consent");
      if (!consent) {
        document.getElementById("cookieBanner").classList.remove("d-none");
      }
    }

    function sendCookieConsentToServer(consent) {
      fetch("/salva-cookie-consent/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ consent: consent })
      });
    }

    function acceptCookies() {
      setCookie("cookie_consent", "accepted", 365);
      document.getElementById("cookieBanner").classList.add("d-none");
      sendCookieConsentToServer("accepted");
    }

    function rejectCookies() {
      setCookie("cookie_consent", "rejected", 365);
      document.getElementById("cookieBanner").classList.add("d-none");
      sendCookieConsentToServer("rejected");
    }

    function manageCookies() {
      alert("Qui puoi aggiungere la gestione avanzata dei cookie.");
    }

    document.addEventListener("DOMContentLoaded", checkCookieConsent);
  </script>
  <script>
    if (location.href.includes('phish') || document.body.innerText.includes('bitcoin')) {
      alert("Attività sospetta rilevata.");
      location.href = "/";  // oppure mostra un overlay
    }
  </script>
  
</body>
</html>

