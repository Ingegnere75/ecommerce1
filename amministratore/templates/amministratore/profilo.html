{% extends 'base.html' %}

{% block content %}

<div class="mb-4">
    
    <a href="{% url 'admin-dashboard' %}" class="btn btn-outline-primary rounded-pill">
      <i class="fas fa-arrow-left me-1"></i> Torna alla Dashboard
    </a>
  </div>


<style>
    .custom-table {
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
        border-radius: 10px;
        overflow-x: auto;
        background-color: #ffffff;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
        width: 100%;
    }

    .custom-table input {
        border: 1px solid #dcdcdc;
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 0.85rem;
        width: 100%;
        background-color: #f9f9f9;
        min-width: 120px;
    }

    .custom-table th,
    .custom-table td {
        vertical-align: middle !important;
        text-align: center;
        padding: 10px 8px;
        white-space: nowrap;
    }

    .table-info th {
        background-color: #f1f6ff;
        color: #333;
        font-weight: 600;
    }

    .action-buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .alert-success {
        display: none;
        margin-bottom: 1rem;
        padding: 0.75rem 1.2rem;
        border: 1px solid #c3e6cb;
        border-radius: 0.5rem;
        background-color: #d4edda;
        color: #155724;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .custom-table tr:hover {
        background-color: #f5f5f5;
    }

    @media (max-width: 768px) {
        .custom-table input {
            font-size: 0.75rem;
            padding: 5px 8px;
        }

        .custom-table th, .custom-table td {
            font-size: 0.75rem;
        }
    }
</style>

<div class="container-fluid mt-4 px-4">
    <h3 class="text-center mb-3 text-primary"><i class="fas fa-users-cog"></i> Gestione Profili Utente</h3>

    <div id="alert-success" class="alert-success text-center">
        ‚úÖ Profilo aggiornato con successo!
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered custom-table">
            <thead class="table-info">
                <tr>
                    <th>Nome</th>
                    <th>Cognome</th>
                    <th>Email</th>
                    <th>Indirizzo</th>
                    <th>Civico</th>
                    <th>CAP</th>
                    <th>Citt√†</th>
                    <th>Provincia</th>
                    <th>Codice Fiscale</th>
                    <th>Telefono</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for profilo in utenti %}
                <tr>
                    <form method="post" class="modifica-form" data-id="{{ profilo.id }}">
                        {% csrf_token %}
                        <td><input type="text" name="nome" value="{{ profilo.nome }}"></td>
                        <td><input type="text" name="cognome" value="{{ profilo.cognome }}"></td>
                        <td><input type="email" name="email" value="{{ profilo.user.email }}"></td>
                        <td><input type="text" name="indirizzo" value="{{ profilo.indirizzo }}"></td>
                        <td><input type="text" name="civico" value="{{ profilo.civico }}"></td>
                        <td><input type="text" name="cap" value="{{ profilo.cap }}"></td>
                        <td><input type="text" name="citta" value="{{ profilo.citta }}"></td>
                        <td><input type="text" name="provincia" value="{{ profilo.provincia }}"></td>
                        <td><input type="text" name="codice_fiscale" value="{{ profilo.codice_fiscale }}"></td>
                        <td><input type="text" name="telefono" value="{{ profilo.telefono }}"></td>
                        <td class="action-buttons">
                            <button type="submit" class="btn btn-outline-success btn-sm px-2">üíæ</button>
                            <a href="{% url 'elimina_utente' profilo.id %}" class="btn btn-outline-danger btn-sm px-2"
                               onclick="return confirm('Sei sicuro di voler eliminare questo utente?');">
                                üóëÔ∏è
                            </a>
                        </td>
                    </form>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="text-center">Nessun utente trovato.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.querySelectorAll('.modifica-form').forEach(form => {
    form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const id = this.getAttribute('data-id');
        const formData = new FormData(this);

        const response = await fetch(`/amministratore/profilo/modifica/${id}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            },
            body: formData
        });

        if (response.ok) {
            const alertBox = document.getElementById('alert-success');
            alertBox.style.display = 'block';
            alertBox.scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3000);
        } else {
            alert('‚ùå Errore durante la modifica.');
        }
    });
});
</script>
{% endblock %}
